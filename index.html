<!DOCTYPE html>
<html lang="zh">
<head>
  <meta charset="UTF-8">
  <title>数某院×山东某高校 知识图谱与安全预警演示</title>
  <script type="text/javascript" src="https://unpkg.com/vis-network@9.1.2/dist/vis-network.min.js"></script>
  <style>
    #network { width: 100%; height: 500px; border: 1px solid #ccc; }
    .warn { color: red; font-weight: bold; }
    body { font-family: "Microsoft YaHei", "微软雅黑", "Arial", sans-serif; }
  </style>
</head>
<body>
  <h2>数某院×山东某高校 知识图谱与安全预警演示</h2>
  <div id="network"></div>
  <div id="warn"></div>
  <script>
    // 读取 triples.json，需与 index.html 放同目录
    fetch('triples.json')
      .then(response => response.json())
      .then(triples => {
        // 构建节点与边
        let nodes = {}, edges = [];
        triples.forEach(tri => {
          nodes[tri.source] = nodes[tri.source] || {id: tri.source, label: tri.source, shape: 'ellipse', color: '#97C2FC'};
          nodes[tri.target] = nodes[tri.target] || {id: tri.target, label: tri.target, shape: 'box', color: '#FFAAAA'};
          edges.push({
            from: tri.source,
            to: tri.target,
            label: tri.type || tri.relation,
            arrows: 'to'
          });
        });
        // 统计被攻击IP出现次数，实现预警
        let ipCount = {};
        triples.forEach(tri => {
          // 只统计 relation 为被攻击IP 的场景
          if(tri.relation === '被攻击IP'){
            ipCount[tri.target] = (ipCount[tri.target] || 0) + 1;
          }
        });
        // 标记高风险IP
        Object.keys(ipCount).forEach(ip => {
          if (ipCount[ip] >= 2) {
            nodes[ip].color = '#FF3333';
            nodes[ip].font = { color: '#fff', size: 18, vadjust: -15 };
          }
        });

        // 可视化
        const container = document.getElementById('network');
        const data = {
          nodes: Object.values(nodes),
          edges: edges
        };
        const options = {
          nodes: { shape: 'ellipse', size: 30 },
          edges: { font: { align: 'top' }, color: '#848484' },
          physics: { enabled: false }
        };
        new vis.Network(container, data, options);

        // 显示预警
        let warnStr = Object.keys(ipCount).filter(ip => ipCount[ip] >= 2)
          .map(ip => `<span class="warn">⚠️ 高风险IP: ${ip} （攻击${ipCount[ip]}台服务器）</span>`).join("<br>");
        document.getElementById('warn').innerHTML = warnStr || "暂无高风险IP";
      });
  </script>
</body>
</html>
